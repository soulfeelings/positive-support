#!/bin/bash

echo "üîß –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–±–æ—Ç–∞ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python3 –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ .env
if [ ! -f ".env" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –Ω–∞ –æ—Å–Ω–æ–≤–µ env.example"
    echo "–ò —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ADMIN_BOT_TOKEN –∏ ADMIN_ID"
    exit 1
fi

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export $(grep -v '^#' .env | xargs)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
if [ -z "$ADMIN_BOT_TOKEN" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: ADMIN_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env —Ñ–∞–π–ª–µ!"
    exit 1
fi

if [ -z "$ADMIN_ID" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: ADMIN_ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env —Ñ–∞–π–ª–µ!"
    exit 1
fi

echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏:"
echo "   - –ê–¥–º–∏–Ω –±–æ—Ç —Ç–æ–∫–µ–Ω: ${ADMIN_BOT_TOKEN:0:10}..."
echo "   - –ê–¥–º–∏–Ω ID: $ADMIN_ID"
echo "   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ${DB_HOST:-localhost}:${DB_PORT:-5432}/${DB_NAME:-support_bot}"
echo ""

echo "üöÄ –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–±–æ—Ç–∞..."
python3 admin_bot.py

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå –û–®–ò–ë–ö–ê: –ê–¥–º–∏–Ω-–±–æ—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!"
    echo "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
    echo "1. –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω-–±–æ—Ç–∞"
    echo "2. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
    echo "3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"
    echo "4. –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pip install -r requirements.txt)"
    exit 1
fi

echo "‚úÖ –ê–¥–º–∏–Ω-–±–æ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω."
