name: Dev Deploy

on:
  push:
    branches: [ dev ]
  pull_request:
    branches: [ dev ]

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Deploy application
      run: |
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ –Ω–∞—à –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
        chmod +x ./deploy.sh
        ./deploy.sh
        
    - name: Verify deployment
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ deploy.sh
        ./deploy.sh status
        
    - name: Cleanup old logs
      run: |
        # –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤
        find . -name "*.log" -type f -mtime +7 -delete || true
        
    - name: Send notification
      if: always()
      run: |
        if [ "${{ job.status }}" == "success" ]; then
          echo "üöÄ Deployment to dev completed successfully"
        else
          echo "‚ùå Deployment to dev failed"
        fi

